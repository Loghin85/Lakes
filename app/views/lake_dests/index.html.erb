<p id="notice"><%= notice %></p>

<h1>Lakes</h1>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="table-tab" data-toggle="tab" href="#table" role="tab" aria-controls="table" aria-selected="true">Table</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="mapt-tab" data-toggle="tab" href="#mapt" role="tab" aria-controls="map" aria-selected="false">Map</a>
  </li>
</ul>
<br>
<div class="tab-content" id="myTabContent">
  <div class="tab-pane fade show active" id="table" role="tabpanel" aria-labelledby="table-tab">
	<table  id="Lakes" class="container-fluid display responsive no-wrap" width="100%">
	  <thead>
		<tr>
		  <th>Name</th>
		  <th>Area</th>
		  <th>District</th>
		  <th>Lat</th>
		  <th>Long</th>
		  <th>River</th>
		  <th>Altitude</th>
		  <th>Alkalinity</th>
		  <th>Depth</th>
		  <th></th>
		</tr>
	  </thead>

	  <tbody>
		<% @lake_dests.each do |lake_dest| %>
		  <tr>
			<td><%= lake_dest.Name %></td>
			<td><%= lake_dest.Area %></td>
			<td><%= lake_dest.District %></td>
			<td><%= lake_dest.Lat %></td>
			<td><%= lake_dest.Long %></td>
			<td><%= lake_dest.River %></td>
			<td><%= lake_dest.Altitude %></td>
			<td><%= lake_dest.Alkalinity %></td>
			<td><%= lake_dest.Depth %></td>
			<td>
				<div class="btn-group" role="group" aria-label="Basic example">
				  <%= link_to 'Show', lake_dest ,class: "btn btn-outline-secondary"%>
				  <% if admin?%>
				  <%= link_to 'Edit', edit_lake_dest_path(lake_dest) ,class: "btn btn-outline-secondary"%>
				  <%= link_to 'Destroy', lake_dest, method: :delete, data: { confirm: 'Are you sure?' } ,class: "btn btn-outline-secondary"%>
				  <%end%>
				</div>
			</td>
		  </tr>
		<% end %>
	  </tbody>
	</table>

	<br>
	<%if admin?%>
	<%= button_to 'New Lake Dest', new_lake_dest_path ,class: "btn btn-primary", method: "get"%>
	<%end%>
	
</div>
<div class="tab-pane fade" id="mapt" role="tabpanel" aria-labelledby="mapt-tab">
	<div id="map" style="height: 600px; width: 80%; margin: auto;"></div>
    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 57.0, lng: -3.58},
          zoom: 7
        });
		 var infowindow = new google.maps.InfoWindow();
	
	var marker, i, markers =[];
	
	

    <% @lake_dests.each do |lake_dest| %>  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(<%= lake_dest.Lat%>, <%= lake_dest.Long%>),
        map: map
      });

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
		  <% @link = link_to(lake_dest.Name+", "+lake_dest.District, lake_dest, )%>
		  infowindow.setContent(<%= @link.to_json.html_safe%>);
          infowindow.open(map, marker);
        }
      })(marker, i));
	  markers.push(marker);
    <% end %>
	  
	var markerCluster = new MarkerClusterer(map, markers,
            {imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'});
	
	  
	  }
	  
    </script>
	<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>

	<br><br>
</div>
</div>